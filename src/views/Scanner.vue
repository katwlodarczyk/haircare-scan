<template>
  <div class="py-0">
    <div
      v-show="loading === true"
      class="w-screen h-screen absolute z-20 text-white"
    >
      <div class="absolute z-10 w-screen h-screen bg-gray-700 opacity-75"></div>
      <div
        class="absolute inset-y-0 mx-auto w-screen flex flex-col justify-center items-center space-y-4 z-30"
      >
        <svg
          width="38"
          height="38"
          viewBox="0 0 38 38"
          xmlns="http://www.w3.org/2000/svg"
          stroke="#fff"
        >
          <g fill="none" fill-rule="evenodd">
            <g transform="translate(1 1)" stroke-width="2">
              <circle stroke-opacity=".5" cx="18" cy="18" r="18" />
              <path d="M36 18c0-9.94-8.06-18-18-18">
                <animateTransform
                  attributeName="transform"
                  type="rotate"
                  from="0 18 18"
                  to="360 18 18"
                  dur="1s"
                  repeatCount="indefinite"
                />
              </path>
            </g>
          </g>
        </svg>
        <h1>{{ loadingSentences[i] }}</h1>
      </div>
    </div>
    <div
      class="absolute z-30 top-0 right-0 left-0 rounded-b-2xl bg-brand-nude flex flex-row justify-center w-screen"
    >
      <svg
        class="-mt-2"
        width="200"
        height="40"
        viewBox="0 0 557 64"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          opacity="0.4"
          d="M372.754 23.3027C371.493 23.3027 370.466 22.2246 370.449 20.8828V17.351C370.49 14.3531 369.408 11.4611 367.442 9.31359C365.476 7.1661 362.788 5.93974 359.971 5.90529H357.512C356.239 5.90529 355.208 4.8072 355.208 3.45265C355.208 2.09809 356.239 1 357.512 1H359.971C368.384 1.10745 375.151 8.39665 375.151 17.351V20.8501C375.167 21.4945 374.938 22.1186 374.516 22.5806C374.093 23.0425 373.513 23.303 372.907 23.3027H372.754ZM318.979 23.3029C318.37 23.3115 317.784 23.0604 317.351 22.6056C316.918 22.1508 316.674 21.5303 316.674 20.8828V17.351C316.625 13.0326 318.202 8.87295 321.054 5.80078C323.906 2.7286 327.796 0.999681 331.854 1H334.374C335.646 1 336.678 2.09809 336.678 3.45265C336.678 4.8072 335.646 5.90529 334.374 5.90529H331.885C329.043 5.89604 326.319 7.10428 324.324 9.25756C322.33 11.4108 321.234 14.3279 321.283 17.351V20.8828C321.266 22.2246 320.239 23.3029 318.979 23.3029Z"
          fill="#9764C7"
        />
        <path
          d="M375.254 37.6233V46.8125C375.155 55.6528 368.472 62.8088 360.166 62.9673H357.677C356.796 63.0761 355.934 62.637 355.461 61.8382C354.988 61.0394 354.988 60.0226 355.461 59.2238C355.934 58.425 356.796 57.9859 357.677 58.0947H360.166C366.026 58.0767 370.767 53.0161 370.767 46.7798V37.6233H375.254ZM336.874 60.5474C336.857 61.8945 335.835 62.9824 334.569 63H332.049C323.636 62.8926 316.869 55.6033 316.869 46.649V37.6233H321.478V46.8125C321.478 53.0361 326.201 58.0914 332.049 58.1274H334.569C335.177 58.1187 335.764 58.3698 336.197 58.8245C336.63 59.2793 336.874 59.8998 336.874 60.5474ZM381 35.1706C381 36.5252 379.968 37.6233 378.695 37.6233H313.305C312.032 37.6233 311 36.5252 311 35.1706C311 33.8161 312.032 32.718 313.305 32.718H378.603C379.23 32.6913 379.84 32.9378 380.293 33.4007C380.745 33.8636 381 34.5028 381 35.1706Z"
          fill="#9764C7"
        />
        <path
          opacity="0.4"
          d="M362.219 26.7513V22.5328C362.219 20.4946 361.458 18.5399 360.104 17.0987C358.75 15.6575 356.913 14.8478 354.998 14.8478H337.421C333.433 14.8478 330.2 18.2885 330.2 22.5328V26.7513C330.216 27.2499 330.592 27.6501 331.06 27.667H361.359C361.827 27.6501 362.203 27.2499 362.219 26.7513Z"
          fill="#9764C7"
        />
        <path
          d="M362.219 37.6298V41.2924C362.219 45.5367 358.986 48.9774 354.998 48.9774H337.421C333.433 48.9774 330.2 45.5367 330.2 41.2924V37.6298H362.219Z"
          fill="#9764C7"
        />
        <path
          d="M405.2 63C407.144 63 410.816 62.784 413.768 61.344C418.808 58.968 422.048 53.136 421.832 46.872C421.616 41.112 418.664 36.576 413.84 34.704C411.608 33.768 409.088 33.192 406.64 32.688C400.232 31.248 394.184 29.88 392.816 22.608C391.88 17.712 393.752 14.328 395.336 12.312C397.928 9.288 401.888 7.488 405.992 7.488C413.84 7.488 417.296 13.104 418.88 18.072L412.688 20.952C412.04 18.792 410.96 16.56 408.584 15.552C405.704 14.4 402.536 15.624 401.168 18.504C399.656 21.528 400.592 24.984 403.616 27.072C404.048 27.432 404.768 27.288 405.128 26.856C405.416 26.424 405.272 25.776 404.84 25.416C402.68 23.904 402.032 21.528 403.112 19.44C403.976 17.568 405.92 16.704 407.72 17.496C409.736 18.288 410.6 20.664 411.032 22.68C411.104 22.968 411.32 23.256 411.608 23.4C411.896 23.544 412.184 23.544 412.472 23.4L420.536 19.584C420.968 19.368 421.256 18.864 421.112 18.36C418.808 10.008 413.48 5.4 405.992 5.4C401.24 5.4 396.704 7.488 393.752 11.016C391.88 13.32 389.72 17.28 390.728 22.968C392.312 31.608 399.368 33.192 406.208 34.704C408.584 35.208 410.888 35.784 413.048 36.648C417.008 38.232 419.528 42.12 419.744 46.944C419.888 52.344 417.152 57.384 412.904 59.472C410.888 60.408 408.152 60.984 405.2 60.984C395.12 60.984 392.672 53.424 391.304 48.456L397.856 45.792C398.504 48.456 399.656 51.984 403.256 52.992C405.272 53.568 407.216 53.28 408.8 52.056C410.384 50.904 411.392 48.888 411.392 46.584C411.392 42.48 408.872 40.68 406.568 39.6C406.064 39.384 405.416 39.528 405.2 40.032C404.984 40.536 405.128 41.184 405.704 41.4C407.576 42.336 409.304 43.632 409.304 46.584C409.304 48.168 408.728 49.536 407.576 50.4C406.568 51.192 405.2 51.408 403.832 50.976C401.096 50.184 400.304 47.304 399.656 44.136C399.584 43.848 399.368 43.56 399.08 43.416C398.792 43.344 398.504 43.272 398.216 43.416L389.576 46.872C389.144 47.016 388.856 47.52 389 48.024V48.312C390.44 53.424 393.032 63 405.2 63ZM449.312 63.864C461.264 63.864 463.208 47.736 463.496 42.768C463.496 42.192 463.136 41.616 462.56 41.616L451.472 40.824C450.896 40.824 450.392 41.184 450.32 41.76C450.32 42.336 450.32 43.056 450.32 43.848C450.248 46.656 450.176 50.544 448.088 51.984C447.656 52.344 447.512 52.992 447.872 53.424C448.232 53.928 448.88 54.144 449.312 53.784C452.264 51.696 452.336 47.16 452.336 43.92V42.984L461.336 43.704C460.904 49.032 458.744 61.704 449.384 61.776H449.312C447.224 61.776 445.424 60.552 444.128 58.248C443.408 56.952 442.544 52.92 442.544 41.256V40.968V35.28C442.544 32.328 442.688 23.472 443.984 19.584C444.92 17.064 445.856 16.704 447.44 16.704C450.032 16.704 450.32 23.04 450.392 27.648V28.08C450.392 28.368 450.608 28.656 450.824 28.872C451.04 29.016 451.256 29.16 451.544 29.16L462.92 28.152C463.496 28.08 463.856 27.576 463.856 27C462.704 8.496 454.208 4.536 447.296 4.536H447.152C442.832 4.536 439.232 5.976 436.424 8.928C430.448 14.976 429.296 26.208 429.296 34.56C429.296 46.656 431.384 54.792 435.848 59.544C436.208 59.904 436.856 59.976 437.288 59.544C437.648 59.184 437.72 58.464 437.36 58.032C433.328 53.784 431.312 45.936 431.312 34.56C431.312 26.64 432.464 15.984 437.864 10.44C440.24 7.92 443.408 6.696 447.224 6.696C455.792 6.696 460.688 13.32 461.696 26.136L452.48 26.856C452.336 20.952 451.976 14.472 447.512 14.472H447.44C444.776 14.472 443.192 15.768 442.112 18.864C440.816 22.608 440.528 30.024 440.528 35.208V40.968V41.256C440.528 47.52 440.672 56.304 442.328 59.328C443.984 62.208 446.504 63.864 449.24 63.864H449.312ZM510.799 61.776L505.831 40.824L497.479 6.264C497.335 5.76 496.975 5.4 496.471 5.4H485.383C484.879 5.4 484.447 5.76 484.303 6.264L476.023 40.824L471.055 61.776C470.983 62.064 471.055 62.424 471.271 62.64C471.415 62.856 471.775 63 472.063 63H482.575H482.863C483.007 63 483.151 62.928 483.295 62.784C483.439 62.712 483.511 62.568 483.583 62.424C483.583 62.424 483.655 62.208 483.655 62.136L486.679 45.504C487.183 42.84 487.831 42.048 490.711 42.048L490.855 41.976L490.927 42.048H495.391H495.535C495.607 42.048 495.751 41.976 495.823 41.976C495.967 41.904 496.111 41.76 496.183 41.688C496.255 41.544 496.399 41.4 496.399 41.256V40.896V40.824L491.935 16.632C491.863 16.2 491.503 15.84 490.927 15.84C490.423 15.84 489.991 16.2 489.919 16.632L486.607 34.416C486.535 34.992 486.895 35.424 487.471 35.568C488.047 35.64 488.623 35.352 488.695 34.776L490.927 22.536L494.167 39.96H490.927H490.855H490.711C486.535 39.96 485.239 41.976 484.663 45.144L481.783 60.984H473.359L478.111 41.328L486.175 7.488H495.679L503.815 41.256L508.495 60.984H500.143L498.847 53.784L498.127 49.824C498.127 49.32 497.551 48.888 496.975 48.96H491.719C491.143 48.96 490.639 49.464 490.639 50.04C490.639 50.616 491.143 51.048 491.719 51.048H496.255L496.831 54.216L498.343 62.136C498.343 62.208 498.415 62.424 498.415 62.424C498.487 62.568 498.559 62.712 498.703 62.784C498.775 62.856 498.991 63 499.063 63H499.351H509.863C510.151 63 510.511 62.856 510.655 62.64C510.799 62.424 510.799 61.776 510.799 61.776ZM525.763 7.488C528.571 7.488 529.579 8.424 530.875 10.656L554.419 53.424L554.491 53.496C554.563 53.64 554.707 53.784 554.851 53.784C554.923 53.856 555.139 53.928 555.211 53.928H555.571C555.715 53.928 555.787 53.784 555.931 53.784C556.003 53.712 556.147 53.568 556.219 53.496C556.291 53.352 556.291 53.208 556.291 53.064V52.92V6.48C556.291 5.904 555.931 5.4 555.355 5.4H544.267C543.691 5.4 543.259 5.904 543.259 6.48V19.584C543.259 20.16 543.691 20.664 544.267 20.664C544.843 20.664 545.347 20.16 545.347 19.584V7.488H554.275V48.888L532.675 9.72C531.163 7.056 529.507 5.4 525.763 5.4H517.555C516.979 5.4 516.547 5.904 516.547 6.48V61.992C516.547 62.28 516.619 62.568 516.835 62.712C516.979 62.928 517.267 63 517.555 63H528.283C528.859 63 529.291 62.568 529.291 61.992V30.744L543.331 57.6V57.672L544.483 59.472C546.211 61.992 548.227 63 551.683 63H555.355C555.931 63 556.291 62.568 556.291 61.992C556.291 61.416 555.931 60.984 555.355 60.984H551.683C548.515 60.984 547.363 60.048 546.283 58.392L545.131 56.592L529.219 26.064L529.075 25.92C529.003 25.848 528.931 25.704 528.787 25.632C528.643 25.56 528.499 25.56 528.355 25.56H527.995C527.851 25.56 527.779 25.632 527.635 25.704C527.491 25.776 527.419 25.848 527.347 25.992C527.275 26.136 527.203 26.28 527.203 26.424V26.568V60.984H518.563V7.488H525.763Z"
          fill="#9764C7"
        />
        <path
          d="M11.736 62.072C12.024 62.072 12.24 62 12.384 61.784C12.6 61.64 12.672 61.352 12.672 61.064V42.776C12.672 42.2 12.312 41.768 11.736 41.768C11.16 41.768 10.656 42.2 10.656 42.776V59.984H2.016V6.56H10.656V31.472C10.656 36.008 11.664 38.384 16.992 38.384H19.584V60.992C19.584 61.568 20.016 62 20.592 62H31.248C31.824 62 32.328 61.568 32.328 60.992V5.552C32.328 4.976 31.824 4.472 31.248 4.472H20.592C20.016 4.472 19.584 4.976 19.584 5.552V30.608C19.584 31.184 20.016 31.616 20.592 31.616C21.168 31.616 21.6 31.184 21.6 30.608V6.56H30.24V59.984H21.6V37.376C21.6 36.8 21.168 36.368 20.592 36.368H16.992C13.248 36.368 12.672 35.288 12.672 31.472V5.552C12.672 4.976 12.312 4.472 11.736 4.472H1.008C0.432 4.472 0 4.976 0 5.552V60.992C0 61.568 0.432 62 1.008 62L11.664 62.072H11.736ZM79.2596 60.776L74.2916 39.824L65.9396 5.264C65.7956 4.76 65.4356 4.4 64.9316 4.4H53.8436C53.3396 4.4 52.9076 4.76 52.7636 5.264L44.4836 39.824L39.5156 60.776C39.4436 61.064 39.5156 61.424 39.7316 61.64C39.8756 61.856 40.2356 62 40.5236 62H51.0356H51.3236C51.4676 62 51.6116 61.928 51.7556 61.784C51.8996 61.712 51.9716 61.568 52.0436 61.424C52.0436 61.424 52.1156 61.208 52.1156 61.136L55.1396 44.504C55.6436 41.84 56.2916 41.048 59.1716 41.048L59.3156 40.976L59.3876 41.048H63.8516H63.9956C64.0676 41.048 64.2116 40.976 64.2836 40.976C64.4276 40.904 64.5716 40.76 64.6436 40.688C64.7156 40.544 64.8596 40.4 64.8596 40.256V39.896V39.824L60.3956 15.632C60.3236 15.2 59.9636 14.84 59.3876 14.84C58.8836 14.84 58.4516 15.2 58.3796 15.632L55.0676 33.416C54.9956 33.992 55.3556 34.424 55.9316 34.568C56.5076 34.64 57.0836 34.352 57.1556 33.776L59.3876 21.536L62.6276 38.96H59.3876H59.3156H59.1716C54.9956 38.96 53.6996 40.976 53.1236 44.144L50.2436 59.984H41.8196L46.5716 40.328L54.6356 6.488H64.1396L72.2756 40.256L76.9556 59.984H68.6036L67.3076 52.784L66.5876 48.824C66.5876 48.32 66.0116 47.888 65.4356 47.96H60.1796C59.6036 47.96 59.0996 48.464 59.0996 49.04C59.0996 49.616 59.6036 50.048 60.1796 50.048H64.7156L65.2916 53.216L66.8036 61.136C66.8036 61.208 66.8756 61.424 66.8756 61.424C66.9476 61.568 67.0196 61.712 67.1636 61.784C67.2356 61.856 67.4516 62 67.5236 62H67.8116H78.3236C78.6116 62 78.9716 61.856 79.1156 61.64C79.2596 61.424 79.2596 60.776 79.2596 60.776ZM96.3838 62C96.9598 62 97.3918 61.568 97.3918 60.992V5.48C97.3918 4.904 96.9598 4.4 96.3838 4.4H86.0158C85.4398 4.4 85.0078 4.904 85.0078 5.48V11.744C85.0078 12.32 85.4398 12.752 86.0158 12.752C86.5918 12.752 87.0238 12.32 87.0238 11.744V6.488H95.3758V59.984H87.0238V22.544C87.0238 18.944 88.3918 18.656 90.4078 18.656H91.6318C92.2078 18.656 92.7118 18.224 92.7118 17.648C92.7118 17.072 92.2078 16.568 91.6318 16.568H90.4078C87.8878 16.568 85.0078 17.288 85.0078 22.544V60.992C85.0078 61.568 85.4398 62 86.0158 62H96.3838ZM136.593 62C136.881 62 137.169 61.928 137.385 61.64C137.529 61.352 137.673 60.992 137.529 60.704L130.329 38.816C130.401 38.744 130.545 38.672 130.545 38.672C134.145 35.72 136.305 29.888 136.305 23.12C136.305 17.936 135.153 13.616 132.921 10.16C129.321 4.472 123.633 4.4 118.665 4.4H105.633C105.057 4.4 104.625 4.904 104.625 5.48V25.424C104.625 26 105.057 26.432 105.633 26.432C106.209 26.432 106.641 26 106.641 25.424V6.488H118.665C123.561 6.488 128.169 6.488 131.193 11.312C133.209 14.336 134.289 18.296 134.289 23.12C134.289 29.168 132.273 34.568 129.249 37.016C129.033 37.232 128.817 37.448 128.529 37.52C128.313 37.736 128.097 38.024 128.097 38.312C128.097 38.456 128.097 38.672 128.169 38.744L135.153 59.984H126.081L120.753 40.328C120.753 40.112 120.609 39.896 120.465 39.824C120.321 39.608 120.105 39.464 119.817 39.464H116.145C115.569 39.464 115.065 39.896 115.065 40.472V59.984H106.641V34.928C106.641 32.408 107.289 31.76 109.809 31.76H118.665C123.417 31.76 125.217 29.24 125.217 22.256C125.217 19.952 125.217 13.184 118.665 13.184H116.145C115.569 13.184 115.065 13.616 115.065 14.192V23.984C115.065 24.56 115.569 25.064 116.145 25.064C116.721 25.064 117.081 24.56 117.081 23.984V15.272H118.665C121.905 15.272 123.129 17.288 123.129 22.256C123.129 29.24 121.329 29.744 118.665 29.744H109.809C106.137 29.744 104.625 31.256 104.625 34.928V60.992C104.625 61.568 105.057 62 105.633 62H116.145C116.721 62 117.081 61.568 117.081 60.992V41.552H119.025L124.281 61.28C124.425 61.712 124.785 62 125.289 62H136.593ZM165.077 62.864C177.029 62.864 178.973 46.736 179.261 41.768C179.261 41.192 178.901 40.616 178.325 40.616L167.237 39.824C166.661 39.824 166.157 40.184 166.085 40.76C166.085 41.336 166.085 42.056 166.085 42.848C166.013 45.656 165.941 49.544 163.853 50.984C163.421 51.344 163.277 51.992 163.637 52.424C163.997 52.928 164.645 53.144 165.077 52.784C168.029 50.696 168.101 46.16 168.101 42.92V41.984L177.101 42.704C176.669 48.032 174.509 60.704 165.149 60.776H165.077C162.989 60.776 161.189 59.552 159.893 57.248C159.173 55.952 158.309 51.92 158.309 40.256V39.968V34.28C158.309 31.328 158.453 22.472 159.749 18.584C160.685 16.064 161.621 15.704 163.205 15.704C165.797 15.704 166.085 22.04 166.157 26.648V27.08C166.157 27.368 166.373 27.656 166.589 27.872C166.805 28.016 167.021 28.16 167.309 28.16L178.685 27.152C179.261 27.08 179.621 26.576 179.621 26C178.469 7.496 169.973 3.536 163.061 3.536H162.917C158.597 3.536 154.997 4.976 152.189 7.928C146.213 13.976 145.061 25.208 145.061 33.56C145.061 45.656 147.149 53.792 151.613 58.544C151.973 58.904 152.621 58.976 153.053 58.544C153.413 58.184 153.485 57.464 153.125 57.032C149.093 52.784 147.077 44.936 147.077 33.56C147.077 25.64 148.229 14.984 153.629 9.44C156.005 6.92 159.173 5.696 162.989 5.696C171.557 5.696 176.453 12.32 177.461 25.136L168.245 25.856C168.101 19.952 167.741 13.472 163.277 13.472H163.205C160.541 13.472 158.957 14.768 157.877 17.864C156.581 21.608 156.293 29.024 156.293 34.208V39.968V40.256C156.293 46.52 156.437 55.304 158.093 58.328C159.749 61.208 162.269 62.864 165.005 62.864H165.077ZM226.564 60.776L221.596 39.824L213.244 5.264C213.1 4.76 212.74 4.4 212.236 4.4H201.148C200.644 4.4 200.212 4.76 200.068 5.264L191.788 39.824L186.82 60.776C186.748 61.064 186.82 61.424 187.036 61.64C187.18 61.856 187.54 62 187.828 62H198.34H198.628C198.772 62 198.916 61.928 199.06 61.784C199.204 61.712 199.276 61.568 199.348 61.424C199.348 61.424 199.42 61.208 199.42 61.136L202.444 44.504C202.948 41.84 203.596 41.048 206.476 41.048L206.62 40.976L206.692 41.048H211.156H211.3C211.372 41.048 211.516 40.976 211.588 40.976C211.732 40.904 211.876 40.76 211.948 40.688C212.02 40.544 212.164 40.4 212.164 40.256V39.896V39.824L207.7 15.632C207.628 15.2 207.268 14.84 206.692 14.84C206.188 14.84 205.756 15.2 205.684 15.632L202.372 33.416C202.3 33.992 202.66 34.424 203.236 34.568C203.812 34.64 204.388 34.352 204.46 33.776L206.692 21.536L209.932 38.96H206.692H206.62H206.476C202.3 38.96 201.004 40.976 200.428 44.144L197.548 59.984H189.124L193.876 40.328L201.94 6.488H211.444L219.58 40.256L224.26 59.984H215.908L214.612 52.784L213.892 48.824C213.892 48.32 213.316 47.888 212.74 47.96H207.484C206.908 47.96 206.404 48.464 206.404 49.04C206.404 49.616 206.908 50.048 207.484 50.048H212.02L212.596 53.216L214.108 61.136C214.108 61.208 214.18 61.424 214.18 61.424C214.252 61.568 214.324 61.712 214.468 61.784C214.54 61.856 214.756 62 214.828 62H215.116H225.628C225.916 62 226.276 61.856 226.42 61.64C226.564 61.424 226.564 60.776 226.564 60.776ZM264.281 62C264.569 62 264.857 61.928 265.073 61.64C265.217 61.352 265.361 60.992 265.217 60.704L258.017 38.816C258.089 38.744 258.233 38.672 258.233 38.672C261.833 35.72 263.993 29.888 263.993 23.12C263.993 17.936 262.841 13.616 260.609 10.16C257.009 4.472 251.32 4.4 246.353 4.4H233.321C232.745 4.4 232.312 4.904 232.312 5.48V25.424C232.312 26 232.745 26.432 233.321 26.432C233.897 26.432 234.329 26 234.329 25.424V6.488H246.353C251.249 6.488 255.857 6.488 258.881 11.312C260.897 14.336 261.977 18.296 261.977 23.12C261.977 29.168 259.961 34.568 256.937 37.016C256.721 37.232 256.505 37.448 256.217 37.52C256.001 37.736 255.785 38.024 255.785 38.312C255.785 38.456 255.785 38.672 255.857 38.744L262.841 59.984H253.769L248.441 40.328C248.441 40.112 248.297 39.896 248.153 39.824C248.009 39.608 247.793 39.464 247.505 39.464H243.833C243.257 39.464 242.753 39.896 242.753 40.472V59.984H234.329V34.928C234.329 32.408 234.977 31.76 237.497 31.76H246.353C251.105 31.76 252.905 29.24 252.905 22.256C252.905 19.952 252.905 13.184 246.353 13.184H243.833C243.257 13.184 242.753 13.616 242.753 14.192V23.984C242.753 24.56 243.257 25.064 243.833 25.064C244.409 25.064 244.769 24.56 244.769 23.984V15.272H246.353C249.593 15.272 250.816 17.288 250.816 22.256C250.816 29.24 249.017 29.744 246.353 29.744H237.497C233.825 29.744 232.312 31.256 232.312 34.928V60.992C232.312 61.568 232.745 62 233.321 62H243.833C244.409 62 244.769 61.568 244.769 60.992V41.552H246.713L251.969 61.28C252.113 61.712 252.473 62 252.977 62H264.281ZM300.541 62C301.117 62 301.549 61.568 301.549 60.992V51.272C301.549 50.696 301.117 50.192 300.541 50.192H285.205V44.144C285.205 43.568 284.773 43.064 284.197 43.064C283.621 43.064 283.117 43.568 283.117 44.144V51.272C283.117 51.848 283.621 52.28 284.197 52.28H299.533V59.984H274.477V42.704C274.477 40.328 276.493 38.384 278.869 38.384H296.653C297.229 38.384 297.733 37.952 297.733 37.376V28.088C297.733 27.512 297.229 27.08 296.653 27.08H285.205V16.208H300.541C301.117 16.208 301.549 15.776 301.549 15.2V5.48C301.549 4.904 301.117 4.4 300.541 4.4H273.469C272.893 4.4 272.461 4.904 272.461 5.48V32.984C272.461 33.56 272.893 33.992 273.469 33.992C274.045 33.992 274.477 33.56 274.477 32.984V6.488H299.533V14.192H284.197C283.621 14.192 283.117 14.624 283.117 15.2V28.088C283.117 28.664 283.621 29.168 284.197 29.168H295.717V36.368H278.797H278.653C275.197 36.44 272.461 39.248 272.461 42.632V42.704V60.992C272.461 61.568 272.893 62 273.469 62H300.541Z"
          fill="#9764C7"
        />
      </svg>
    </div>
    <div
      class="bg-gray-800 w-screen h-screen flex flex-col justify-between pt-12 pb-8"
    >
      <svg
        @click="stopCameraStream()"
        xmlns="http://www.w3.org/2000/svg"
        class="self-end mr-4 text-white h-6 w-6"
        viewBox="0 0 20 20"
        fill="currentColor"
      >
        <path
          fill-rule="evenodd"
          d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
          clip-rule="evenodd"
        />
      </svg>

      <video
        v-show="!isPhotoTaken"
        ref="camera"
        :width="375"
        :height="600"
        autoplay
        playsinline
      ></video>
      <canvas
        id="photoTaken"
        v-show="isPhotoTaken"
        ref="canvas"
        :width="375"
        :height="600"
      ></canvas>

      <div
        class="w-full flex flex-row justify-between items-center text-white px-6"
        :class="!isPhotoTaken ? 'mx-auto' : ''"
      >
        <BrandButton
          v-show="isPhotoTaken"
          @click="retake"
          class="flex justify-between items-center space-x-2"
        >
          <span>Retake</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
            />
          </svg>
        </BrandButton>
        <svg
          v-show="!isPhotoTaken"
          @click="$router.push('/analyze-text')"
          class="absolute bottom-10 right-6"
          width="42"
          height="42"
          viewBox="0 0 48 48"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M31.8174 4C38.1054 4 42.3294 8.306 42.3294 14.714V33.106C42.3294 39.57 38.2354 43.774 31.8994 43.814L16.5134 43.82C10.2254 43.82 5.99939 39.514 5.99939 33.106V14.714C5.99939 8.248 10.0934 4.046 16.4294 4.008L31.8154 4H31.8174ZM31.8174 7L16.4394 7.008C11.7834 7.036 8.99939 9.916 8.99939 14.714V33.106C8.99939 37.936 11.8094 40.82 16.5114 40.82L31.8894 40.814C36.5454 40.786 39.3294 37.902 39.3294 33.106V14.714C39.3294 9.884 36.5214 7 31.8174 7ZM31.4316 30.9474C32.2596 30.9474 32.9316 31.6194 32.9316 32.4474C32.9316 33.2754 32.2596 33.9474 31.4316 33.9474H16.9916C16.1636 33.9474 15.4916 33.2754 15.4916 32.4474C15.4916 31.6194 16.1636 30.9474 16.9916 30.9474H31.4316ZM31.4316 22.5744C32.2596 22.5744 32.9316 23.2464 32.9316 24.0744C32.9316 24.9024 32.2596 25.5744 31.4316 25.5744H16.9916C16.1636 25.5744 15.4916 24.9024 15.4916 24.0744C15.4916 23.2464 16.1636 22.5744 16.9916 22.5744H31.4316ZM22.501 14.2208C23.329 14.2208 24.001 14.8928 24.001 15.7208C24.001 16.5488 23.329 17.2208 22.501 17.2208H16.991C16.163 17.2208 15.491 16.5488 15.491 15.7208C15.491 14.8928 16.163 14.2208 16.991 14.2208H22.501Z"
            fill="white"
          />
        </svg>

        <svg
          v-show="!isPhotoTaken"
          @click="takePhoto()"
          class="mx-auto z-30 fill-current text-white"
          width="64"
          height="64"
          viewBox="0 0 48 48"
          fill="white"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            opacity="0.4"
            d="M29.525 13.4853C30.735 13.4853 31.897 13.9619 32.743 14.8111C33.595 15.6681 34.067 16.8194 34.065 18.0177V20.5084C34.055 20.8006 33.817 21.0379 33.519 21.0457H14.479C14.183 21.0359 13.945 20.7986 13.9388 20.5084V18.0177C13.917 15.5367 15.949 13.5108 18.477 13.4853H29.525ZM34.3872 6.00059C38.7812 6.00059 42.3532 9.50329 42.3532 13.8121V17.5246C42.3532 18.3483 41.6732 19.019 40.8312 19.019C39.9912 19.019 39.3092 18.3483 39.3092 17.5246V13.8121C39.3092 11.1507 37.1012 8.98554 34.3872 8.98554H31.2012C30.3612 8.98554 29.6792 8.31873 29.6792 7.49502C29.6792 6.66936 30.3612 6.00059 31.2012 6.00059H34.3872ZM16.8554 6C17.6954 6 18.3774 6.66877 18.3774 7.49444C18.3774 8.31814 17.6974 8.98691 16.8554 8.98691L13.5974 8.98887C10.8934 8.99279 8.6934 11.1521 8.6934 13.8056V17.524C8.6934 18.3477 8.0094 19.0185 7.1694 19.0185C6.3294 19.0185 5.6474 18.3477 5.6474 17.524V13.8056C5.6474 9.50663 9.2134 6.00588 13.5954 6.00196L16.8554 6Z"
            fill="#ffffff"
          />
          <path
            d="M44.478 24.0825H3.524C2.684 24.0825 2 24.7512 2 25.5769C2 26.4006 2.684 27.0674 3.524 27.0674H5.646V34.1944C5.646 38.4934 9.214 41.9941 13.596 41.998L16.854 42C17.696 42 18.376 41.3312 18.378 40.5056C18.378 39.6818 17.696 39.0131 16.856 39.0131L13.6 39.0111C10.894 39.0072 8.692 36.8479 8.692 34.1944V27.0674H13.938V29.0502C13.918 31.5311 15.948 33.559 18.476 33.5825H29.524C32.054 33.559 34.084 31.5311 34.064 29.0502V27.0674H39.31V34.1866C39.31 36.8499 37.102 39.0131 34.388 39.0131H31.202C30.36 39.0131 29.678 39.6818 29.678 40.5056C29.678 41.3312 30.36 42 31.202 42H34.388C38.78 42 42.354 38.4973 42.354 34.1866V27.0674H44.478C45.318 27.0674 46 26.4006 46 25.5769C46 24.7512 45.318 24.0825 44.478 24.0825Z"
            fill="#ffffff"
          />
        </svg>
        <BrandButton
          @click="analyzeFunction(capturedImage)"
          v-show="isPhotoTaken"
          type="dark"
          class="flex justify-between items-center space-x-2"
        >
          <span>Analyze</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M13 5l7 7-7 7M5 5l7 7-7 7"
            />
          </svg>
        </BrandButton>
      </div>
    </div>
  </div>
</template>

<script>
import { onMounted, ref as ref } from "vue";
import { useRouter, useRoute } from "vue-router";
import BrandButton from "../components/BrandButton.vue";
import { createWorker, PSM, OEM } from "tesseract.js";
import { useToast } from "vue-toastification";
import {
  getStorage,
  ref as storageRef,
  uploadString,
  getDownloadURL,
} from "firebase/storage";
import {
  doc,
  getFirestore,
  setDoc,
  query,
  where,
  collection,
  getDocs,
} from "firebase/firestore";
import { DateTime } from "luxon";

export default {
  components: {
    BrandButton,
  },
  setup() {
    const db = getFirestore();
    const typesRef = collection(db, "types");
    const toast = useToast();
    const userUID = localStorage.getItem("userUID");
    const capturedImageName = ref("");
    const storage = getStorage();
    const router = useRouter();
    const route = useRoute();
    const camera = ref();
    const canvas = ref();
    const capturedImage = ref();
    const base64Strip = ref();
    const loading = ref(false);
    const ingredientsArray = ref();
    const analyzedTypes = ref();
    const analyzedIngredients = ref();
    const ingredientsTypes = ref();
    const loadingSentences = [
      "Recognizing ingredients...",
      "Analyzing the types...",
      "Saving the scan...",
      "Preparing the view...",
      "Not much longer now...",
    ];
    let i = ref(0);

    const isCameraOpen = ref(true);
    const isPhotoTaken = ref(false);

    const metadata = {
      contentType: "image/png",
    };

    onMounted(() => {
      loading.value = true;
      createCameraElement();
      loading.value = false;
    });

    function createCameraElement() {
      const constraints = (window.constraints = {
        audio: false,
        video: {
          facingMode: "environment",
          width: { min: 375, ideal: 1280 },
          height: { min: 600, ideal: 2048 },
          aspectRatio: 1.33,
        },
      });
      navigator.mediaDevices
        .getUserMedia(constraints)
        .then((stream) => {
          camera.value.srcObject = stream;
        })
        .catch((error) => {
          console.log(error);
          router.back();
        });
    }

    function stopCameraStream() {
      const tracks = camera.value.srcObject.getTracks();
      tracks.forEach((track) => {
        track.stop();
      });
      router.back();
    }

    function takePhoto() {
      canvas.value.width = camera.value.scrollWidth * 4;
      canvas.value.height = camera.value.scrollHeight * 4;
      this.isPhotoTaken = !this.isPhotoTaken;
      const context = canvas.value.getContext("2d");
      const photoFromVideo = camera.value;
      context.imageSmoothingEnabled = false;
      context.drawImage(
        photoFromVideo,
        0,
        0,
        canvas.value.width,
        canvas.value.height
      );
      capturedImage.value = document
        .getElementById("photoTaken")
        .toDataURL("image/png", 1);
      base64Strip.value = capturedImage.value.replace(
        "data:image/png;base64,",
        ""
      );
      const blob = document
        .getElementById("photoTaken")
        .toBlob(function (blob) {
          const url = URL.createObjectURL(blob);
          getNameFromUrl(url);
        });
    }

    function getNameFromUrl(url) {
      const urlArray = url.split("/");
      capturedImageName.value = urlArray.pop();
    }

    const retake = () => {
      capturedImage.value = "";
      i.value = 0;
      capturedImageName.value = "";
      analyzedIngredients.value = [];
      analyzedTypes.value = [];
      isPhotoTaken.value = !isPhotoTaken.value;
    };

    const worker = createWorker({
      workerPath: "../node_modules/tesseract.js/dist/worker.min.js",
      langPath: "../lang-data",
      corePath: "../node_modules/tesseract.js-core/tesseract-core.wasm.js",
      // logger: (m) => console.log(m),
    });

    const analyzeFunction = async () => {
      try {
        await analyze(capturedImage.value);
      } catch (error) {
        loading.value = false;
        toast.error(
          "Oops! Something went wrong. Try again or use analyze from text function.",
          {
            position: "bottom-right",
            timeout: 3000,
            closeOnClick: true,
            pauseOnFocusLoss: true,
            pauseOnHover: true,
            draggable: true,
            draggablePercent: 0.1,
            showCloseButtonOnHover: false,
            hideProgressBar: true,
            closeButton: false,
            icon: true,
            rtl: false,
          }
        );
      }
    };

    const analyze = async (capturedImage) => {
      const scanStorage = storageRef(
        storage,
        `users-scans/${userUID}/${capturedImageName.value}.png`
      );
      loading.value = true;

      setInterval(() => {
        if (i.value < loadingSentences.length - 1) i.value++;
        else i.value = 0;
      }, 6000);

      await worker.load();
      await worker.loadLanguage("eng");
      await worker.initialize("eng", OEM.LSTM_ONLY);
      await worker.setParameters({
        tessedit_pageseg_mode: PSM.SINGLE_BLOCK,
      });
      const {
        data: { text },
      } = await worker.recognize(capturedImage);
      console.log("text", text);

      const textFormatted = text
        .toLowerCase()
        .replace(/(-|\n|\r)/gm, "")
        .replace(/.$/, "");
      const textArray = textFormatted.split(":");
      ingredientsArray.value = textArray[1].split(", ");

      async function compareIngredients(ingredientsArray) {
        const queries = [];
        const analyzed = [];
        const ingredients = [];
        const typedIngredients = [];

        ingredientsArray.forEach((ingredient) => {
          const q = query(
            typesRef,
            where("ingredients", "array-contains", ingredient)
          );
          queries.push(q);
        });
        console.log("queries", queries);

        const compare = async () => {
          return Promise.all(
            queries.map(async (query) => {
              await queryDatabase(query);
            })
          );
        };

        const queryDatabase = async (query) => {
          const querySnapshot = await getDocs(query);
          querySnapshot.forEach((doc) => {
            ingredients.push(
              querySnapshot.query._query.filters[0].value.stringValue
            );
            analyzedIngredients.value = ingredients;
            console.log(
              doc.id,
              " => ",
              doc.data(),
              querySnapshot.query._query.filters[0].value.stringValue
            );
            const typedIngredient = {
              ingredient:
                querySnapshot.query._query.filters[0].value.stringValue,
              type: doc.data().name,
              color: doc.data().color,
            };

            analyzed.push(doc.data());
            analyzedTypes.value = analyzed;

            typedIngredients.push(typedIngredient);
            ingredientsTypes.value = typedIngredients;
          });
        };

        await compare();
        progressOrStopExecution();
      }

      async function progressOrStopExecution() {
        if (analyzedTypes.value) {
          await uploadString(scanStorage, base64Strip.value, "base64", metadata)
            .then((snapshot) => {
              console.log("Uploaded a base64url string!");
              getDownloadURL(snapshot.ref).then((downloadURL) => {
                console.log("File available at", downloadURL);
                saveScan(
                  capturedImageName.value,
                  downloadURL,
                  text,
                  ingredientsArray.value,
                  analyzedTypes.value,
                  analyzedIngredients.value,
                  ingredientsTypes.value
                );
              });
            })
            .catch((error) => {
              console.log(error);
            });
          loading.value = false;
          await router.push({
            name: "analyzed",
            params: {
              id: capturedImageName.value,
              scan: capturedImage.value,
            },
          });
        } else {
          loading.value = false;
          toast.error(
            "Oops! Could not analyze it. Try again or use analyze from text function.",
            {
              position: "bottom-right",
              timeout: 4000,
              closeOnClick: true,
              pauseOnFocusLoss: true,
              pauseOnHover: true,
              draggable: true,
              draggablePercent: 0.1,
              showCloseButtonOnHover: false,
              hideProgressBar: true,
              closeButton: false,
              icon: true,
              rtl: false,
            }
          );
        }
      }

      await compareIngredients(ingredientsArray.value);

      const saveScan = async (
        capturedImageName,
        scanRef,
        text,
        ingredientsArray,
        analyzedTypes,
        analyzedIngredients,
        ingredientsTypes
      ) => {
        const add = {
          ...{
            date: DateTime.now().toLocaleString(DateTime.DATETIME_SHORT),
            id: capturedImageName,
            scanRef: scanRef,
            text: text,
            scannedIngredients: ingredientsArray,
            analyzedTypes: analyzedTypes,
            analyzedIngredients: analyzedIngredients,
            ingredientsTypes: ingredientsTypes,
          },
        };

        const scanFile = doc(db, `scans-${userUID}`, `${capturedImageName}`);

        try {
          await setDoc(scanFile, add, { merge: true });
        } catch (e) {
          console.log(e);
        }
      };
    };

    return {
      router,
      route,
      camera,
      capturedImage,
      retake,
      analyze,
      loading,
      loadingSentences,
      capturedImageName,
      i,
      takePhoto,
      stopCameraStream,
      isCameraOpen,
      createCameraElement,
      canvas,
      isPhotoTaken,
      analyzeFunction,
      analyzedTypes,
      analyzedIngredients,
    };
  },
};
</script>
